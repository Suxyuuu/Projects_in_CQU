# -*- coding: utf-8 -*-
"""
Created on Fri Apr  3 11:59:43 2020

@author: Suxyuuu

输入 【all特征文件路径】，good【特征名称的txt文件的文件夹路径】，bad【特征名称的txt文件的文件夹路径】--> 
输出 筛选后的【总特征名称的列表】
"""

import os
import AndroidMalwaresDetect.GetAllFeatureList as GetAllFeatureList
import AndroidMalwaresDetect.GetFeatureVector as GetFeatureVector


def findkeyvector(sum_good,sum_bad):
    #特征向量中除去两类的个数都接近总个数的特征（此处样本为1200，去除掉两者sum都大于1100的）
    #去除两类计数都为0和都为1的特征
    s=[]
    for i in range(len(sum_good)):
        if sum_good[i]==0 and sum_bad[i]!=0:
            if i not in s:
                s.append(i)
                #print(sum_good[i],sum_bad[i])
        if sum_bad[i]==0 and sum_good[i]!=0:
            if i not in s:
                s.append(i)
                #print(sum_bad[i],sum_good[i])
        if abs(sum_good[i]-sum_bad[i])>200:
            if i not in s:
                s.append(i)
                #print(sum_bad[i],sum_good[i])
        else:
            pass
    return s
    
    


def get_key_feature_list(all_feature_file_path, good_feature_file_path,bad_feature_file_path):

    #先获取旧的特征名称列表
    all_feature_list_old=GetAllFeatureList.get_all_feature_list(all_feature_file_path)
    old_feature_lenth=len(all_feature_list_old)

    good_feature_vector_list,good_file_list=GetFeatureVector.getFeatureVector(good_feature_file_path,all_feature_list_old)
    bad_feature_vector_list,bad_file_list=GetFeatureVector.getFeatureVector(bad_feature_file_path,all_feature_list_old)

    #print(good_feature_vector_list[0][0])
    #print(bad_feature_vector_list)
    sum_feature_good=[0]*old_feature_lenth
    sum_feature_bad=[0]*old_feature_lenth

    
    for item in good_feature_vector_list:
        for i in range(old_feature_lenth):
            sum_feature_good[i]+=item[i]
    
    for item in bad_feature_vector_list:
        for i in range(old_feature_lenth):
            sum_feature_bad[i]+=item[i]

    #print(sum_feature_good,sum_feature_bad)

    s=findkeyvector(sum_feature_good,sum_feature_bad)   #得到筛选后的特征序号

    all_feature_list_new=[]
    for i in s:
        all_feature_list_new.append(all_feature_list_old[i])
    
    return all_feature_list_new



def main():

    all_feature_file_path=r'D:\apk\all\key_permission.txt'
    good_feature_file_path=r'D:\apk\apktooltest\permission\good_sample_permission'
    bad_feature_file_path=r'D:\apk\apktooltest\permission\bad_sample_permission'

    s=get_key_feature_list(all_feature_file_path, good_feature_file_path,bad_feature_file_path)
    print(s)
    print(len(s))
    

if __name__ == '__main__':
    main()



