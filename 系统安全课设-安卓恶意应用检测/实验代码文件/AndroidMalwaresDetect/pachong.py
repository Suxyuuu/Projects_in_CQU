# -*- coding: utf-8 -*-
"""
Created on Wed Mar 25 17:16:36 2020

@author: 79459
"""

import os
import requests
import re
import html

headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"}
file_path="D:/apk/apktooltest/source_good"
wangzhilist=[358,23,24,27,361,33,345,26,25,30,28,359,360,362,363,31,29]
namelist=['gouwu','yingyin','gongju','shenghuo','lvyou','paishe','xinwen','shejiao','licai','jiaoyu','daohang','meishi','qiche','shangwu','ertong','yundong','zhuti']
for x in range(17):
    for i in range(1,6):
        n=str(i)
        wangzhi='https://appstore.huawei.com/soft/list_'+str(wangzhilist[x])+'_0_'+n     
        respond=requests.get(wangzhi,headers=headers)
        respond.keep_alive = False
        yuanma=respond.text
        result=re.findall('<a.*?btn-blue down.*?onclick.*?https:&#x2F;&#x2F;(.*?),\s.*?>', yuanma, re.S)        
        if result:  
            for j in range(len(result)): 
                file_list = os.listdir(file_path)      
                m=str(j)
                addr=file_path+'/'+namelist[x]+'_'+n+'_'+m+'.apk'
                name=namelist[x]+'_'+n+'_'+m+'.apk'
                if name in file_list:
                    print("已下载过")
                else:
                    text='https://'+result[j]
                    text=html.unescape(text)   #字符转义 比如将html文件中的&#x2F;转化为/
                    apk=requests.get(text)    
                    with open(addr,'wb')as f:
                        f.write(apk.content)
                        f.close()
                    print(namelist[x]+'_'+n+'_'+m+'.apk')
