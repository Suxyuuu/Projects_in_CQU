import os

good_API_file_list = r"F:\System_security\simplify_api\good"
bad_API_file_list = r"F:\System_security\simplify_api\bad"
all_API_file = r"F:\System_security\simplify_api\all"
key_API_file = r'F:\System_security\simplify_api\all'
good_vector_path = r"F:\System_security\Vector\Final_api_vector\good"
bad_vector_path = r"F:\System_security\Vector\Final_api_vector\bad"

count = 1
def get_all_apis(API_file_list, all_API_file):
    API_name_list = os.listdir(API_file_list)
    API_vector = []
    API_file = open(all_API_file+'\\'+'all_API.txt', 'r')
    for item in API_file:
        item = item.strip('\n')
        API_vector.append(item)
    API_file.close()
    API_file = open(all_API_file+'\\'+'all_API.txt', 'a')
    for name in API_name_list:
        file = open(API_file_list+'\\'+name, 'r')
        for item in file:
            global count
            item = item.strip('\n')
            if item.split('/')[0] == 'Landroid' and item not in API_vector:
                API_vector.append(item)
                count += 1
                print(count)
                print(item)
                API_file.write(item+'\n')
        file.close()
    API_file.close()

def get_API_vector(API_file_path, all_API_file, vector_path):
    # 存放良性样本权限的文件夹路径
    file_list = os.listdir(API_file_path)
    # 标准权限集列表
    API_list = []
    # 标准权限集文件路径
    API_file = open(all_API_file+'\\'+'key_API.txt', 'r')
    # 读取标准权限集
    for line in API_file.readlines():
        line = line.strip('\n')
        API_list.append(line)
    print("标准API集大小为%i" % len(API_list))
    API_file.close()
    for name in file_list:
        # 为每个文件构造初始权限特征向量
        single_API = []
        flag = 0
        API_vector = [0]*len(API_list)
        print("文件为:%s" % name)
        file = open(API_file_path+r'\\'+name, 'r')
        # 读取每个文件中的所有权限
        for item in file:
            item = item.strip('\n')
            single_API.append(item)
        print("总API数量为%i" % len(single_API))
        file.close()

        for API in single_API:
            if API in API_list:
                flag += 1
                print("API%i成功:%s" % (flag, API))
                API_vector[API_list.index(API)] = 1
            else:
                flag += 1
                print("API%i不被添加:%s" % (flag, API))
        file = open(vector_path+'\\'+name, 'a')
        for bit in API_vector:
            file.write(str(bit) + '\n')
        file.close()
    API_file.close()




# get_all_apis(good_API_file_list, all_API_file)
# get_all_apis(bad_API_file_list, all_API_file)
get_API_vector(good_API_file_list, key_API_file, good_vector_path)
get_API_vector(bad_API_file_list, key_API_file, bad_vector_path)